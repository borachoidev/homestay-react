<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bitcamp.korea_tour.model.mapper.HomeStayListMapper">
	<!-- 홈스테이 전체 목록 출력 --> <!-- 최저가 , 평점높은순 -->
	<select id="getAllHomeStayList" parameterType="HashMap" resultType="homestaylist">
		SELECT * FROM homeStay
	    WHERE approval=1 AND open=1
	    ORDER BY price ASC
	    LIMIT #{start}, #{perPage}
	</select>
	<select id="getTotalHomeStayList" resultType="int">
		SELECT count(*) FROM homeStay
	    WHERE approval=2 AND open=1
	</select>
	<!-- 사진 한장 -->
	<select id="getHomeStayPhotoNumOfList" parameterType="int" resultType="integer">
		SELECT min(homeStayPhotoNum) FROM homeStay
		join homeStayPhoto on homeStay.homeStayNum=homeStayPhoto.homeStayNum
        And homeStay.approval=1 And homeStay.open=1
        WHERE homeStay.homeStayNum=#{homeStayNum}
        ORDER BY homeStayPhoto.homeStayPhotoNum ASC
	</select>
	<select id="getHomeStayPhotoOfList" parameterType="int" resultType="String">
		SELECT photoName FROM homeStayPhoto WHERE homeStayPhotoNum=#{homeStayPhotoNum}
	</select>
	<!-- 즐겨찾기 여부 -->
	<select id="isMarked" parameterType="HashMap" resultType="int">
		SELECT count(*) FROM homeStayMark WHERE homeStayNum=#{homeStayNum} AND loginNum=#{loginNum}
	</select>
	<!-- 평점 평균 -->
	<select id="getAvgOfStar" parameterType="int" resultType="java.lang.Double">
		select truncate((avg(cleanliness)+avg(communication)+avg(checkIn)+avg(accuracy)+avg(location)+avg(satisfactionForPrice))/6,2) 
		from homeStayStar 
		where homeStayNum=#{homeStayNum}
	</select>
	<!-- 관리자 홈스테이 목록(대기중) -->
	<select id="getAdminHomeStayList" parameterType="HashMap" resultType="homestay">
		SELECT * FROM homeStay
	    WHERE approval=0
	    ORDER BY homeStayNum ASC
	    LIMIT #{start}, #{perPage}
	</select>
	<!-- 관리자 홈스테이 목록(대기중) 개수 -->
	<select id="getTotalAdminHomeStayList" resultType="int">
		SELECT count(*) FROM homeStay
	    WHERE approval=0
	</select>
	<!-- 관리자 홈스테이 승인 -->
	<select id="approveHomeStay" parameterType="int">
		UPDATE homeStay SET approval=2 WHERE homeStayNum=#{homeStayNum}
	</select>
	<!-- 관리자 홈스테이 거절 -->
	<select id="denyHomeStay" parameterType="int">
		UPDATE homeStay SET approval=1 WHERE homeStayNum=#{homeStayNum}
	</select>
</mapper>