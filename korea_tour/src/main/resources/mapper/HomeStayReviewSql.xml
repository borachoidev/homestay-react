<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bitcamp.korea_tour.model.mapper.HomeStayReviewMapper">
	<!-- JOIN : 리뷰출력(글쓴이, 내용, 사진) -->
	<select id="getAllReview" parameterType="int" resultType="joinhomestayreview">
	SELECT * FROM homeStayReview
	LEFT JOIN homeStayReviewPhoto
	ON homeStayReview.homeStayReviewNum=homeStayReviewPhoto.homeStayReviewNum
	WHERE homeStayNum=#{homeStayNum} ORDER BY regroup
	</select>
	
	<!-- Regroup Max 값 구하기 -->
	<select id="maxOfRegroup" resultType="int">
	SELECT MAX(regroup) from homeStayReview
	</select>
	
	<!-- <select id="getReviewsByUser" parameterType="hashmap" resultType="joinmypagereview">
		select r.homeStayReviewNum, r.userNum as hostNum, r.homeStayNum, r.relevel, r.regroup, r.loginNum,
		r.loginId, r.loginPhoto, r.content, r.writeday, r.deleted, p.homeStayPhotoNum, p.photoName 
		from homeStayReview r join homeStayPhoto 
	</select> -->
	<!-- 댓글쓰기 -->
	<insert id="insertReview" parameterType="homestayreview">
	INSERT into homeStayReview
	(userNum,homeStayNum,relevel,regroup,loginNum,loginId,loginPhoto,content,writeday,deleted)
	VALUES ((SELECT userNum from homeStay WHERE homeStayNum=#{homeStayNum}),#{homeStayNum},0,
	#{regroup},#{loginNum},#{loginId},#{loginPhoto},#{content},now(),0)
	</insert>
	
	<!-- 답글쓰기 -->
	<insert id="insertAnswerReview" parameterType="homestayreview">
	INSERT into homeStayReview 
	(userNum,homeStayNum,relevel,regroup,loginNum,loginId,loginPhoto,content,writeday,deleted)
	VALUES (#{userNum},#{homeStayNum},1,#{regroup},#{loginNum},#{loginId},#{loginPhoto},#{content},now(),0)
	</insert>
</mapper>