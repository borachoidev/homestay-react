<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bitcamp.korea_tour.model.mapper.TourAnswerMapper">
   <!-- 플레이스 답글 쿼리 -->
   <insert id="insertPlaceAnswer" parameterType="touranswer">
      INSERT INTO tourAnswer (contentId, loginNum, loginId, loginPhoto, content, writeDay, relevel, regroup)
      VALUES 
      (#{contentId}, #{loginNum}, #{loginId}, #{loginPhoto}, #{content}, now(),0,0)
   </insert>
    <insert id="insertPlaceReAnswer" parameterType="touranswer">
      insert into tourAnswer (contentId, loginNum, loginId, loginPhoto, content, writeDay, relevel, regroup)
      values
      (#{contentId}, #{loginNum}, #{loginId}, #{loginPhoto}, #{content}, now(),1,#{tourAnswerNum})
   </insert>
   <select id="getTotalCountPlaceAnswer" parameterType="int" resultType="int"><!-- courseNum이 널값인 경우에 Place로 구분 -->
         select count(*) from tourAnswer where relevel=0 and courseNum is null and loginNum=#{loginNum}
   </select>
   <select id="getTotalCountPlaceReAnswer" parameterType="int" resultType="int">
         select count(*) from tourAnswer where relevel=1 and courseNum is null and loginNum=#{loginNum}
   </select>
   <update id="deletePlaceAnswerByUser" parameterType="int">
      update tourAnswer set deleted=1 where tourAnswerNum=#{tourAnswerNum}
   </update>
   <update id="deletePlaceAnswerByAdmin" parameterType="int">
      update tourAnswer set deleted=2 where tourAnswerNum=#{tourAnswerNum}
   </update>
   <select id="getAnswerOfPlace" parameterType="int" resultType="touranswer">
      select * from tourAnswer where contentId=#{contentId} order by regroup asc,relevel asc
   </select>

   <!-- 코스답글 쿼리 -->
   <insert id="insertCourseAnswer" parameterType="touranswer">
       INSERT INTO tourAnswer (courseNum, loginNum, loginId, loginPhoto, content, writeDay, relevel, regroup)
      VALUES 
      (#{courseNum}, #{loginNum}, #{loginId}, #{loginPhoto}, #{content}, now(),0,0)
   </insert>
     <insert id="insertCourseReAnswer" parameterType="touranswer">
      insert into tourAnswer (courseNum, loginNum, loginId, loginPhoto, content, writeDay, relevel, regroup)
      values
      (#{courseNum}, #{loginNum}, #{loginId}, #{loginPhoto}, #{content}, now(),1,#{tourAnswerNum})
   </insert>
   <update id="deleteCourseAnswerByUser" parameterType="int">
      update tourAnswer set deleted=1 where tourAnswerNum=#{tourAnswerNum}
   </update>
   <update id="deleteCourseAnswerByAdmin" parameterType="int">
      update tourAnswer set deleted=2 where tourAnswerNum=#{tourAnswerNum}
   </update>
   <select id="getAnswerOfCourse" resultType="touranswer">
      select * from tourAnswer where courseNum=#{courseNum} order by group asc,relevel asc
   </select>
    <select id="getTotalCountCourseAnswer" parameterType="int" resultType="int">
         select count(*) from tourAnswer where relevel=0 and courseNum is not null and loginNum=#{loginNum}
   </select>
   <select id="getTotalCountCourseReAnswer" parameterType="int" resultType="int">
         select count(*) from tourAnswer where relevel=1 and courseNum is not null and loginNum=#{loginNum}
   </select>
   <!-- 마이 페이지용 댓글 답글 출력 -->
   <select id="getTotalCountAnswer" parameterType="int" resultType="int">
          select count(*) from tourAnswer where relevel=0 and loginNum=#{loginNum}
   </select>
   <select id="getTotalCountReAnswer" parameterType="int" resultType="int">
          select count(*) from tourAnswer where relevel=1 and loginNum=#{loginNum}
   </select>
   <select id="getUserAnswer" parameterType="hashmap" resultType="touranswer"><!-- 내 댓글보기 -->
      SELECT * FROM tourAnswer 
		LEFT JOIN course ON tourAnswer.courseNum=course.courseNum
		LEFT JOIN place ON tourAnswer.contentId=place.contentId
        where loginNum=#{loginNum} and relevel=0 order by tourAnswerNum desc LIMIT #{start},#{perPage}
   </select>
   <select id="getUserReAnswer" parameterType="hashmap" resultType="touranswer"><!-- 내 답글보기 -->
     SELECT * FROM tourAnswer 
		LEFT JOIN course ON tourAnswer.courseNum=course.courseNum
		LEFT JOIN place ON tourAnswer.contentId=place.contentId
        where loginNum=#{loginNum} and relevel=1 order by tourAnswerNum desc LIMIT #{start},#{perPage}
   </select>
   
   <!-- 관리자용 전체 답글 출력 쿼리 -->
   <select id="getTotalCountAnswerAdmin"  resultType="int">
      select count(*) tourAnswer where relevel=0 
   </select>
   <select id="getAdminAnswer"  resultType="touranswer">
      select * from tourAnswer where relevel=0 order by tourAnswerNum desc	LIMIT #{start},#{perPage}
   </select>
   <select id="getTotalCountReAnswerAdmin" resultType="int">
      select count(*) tourAnswer where relevel=1 	
   </select>
   <select id="getAdminReAnswer"  resultType="touranswer">
      select * from tourAnswer where relevel=1 order by tourAnswerNum desc	LIMIT #{start},#{perPage}
   </select>
</mapper>