<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bitcamp.korea_tour.model.mapper.TourAnswerMapper">
	<!-- 플레이스 답글 쿼리 -->
	   <insert id="insertPlaceAnswer" parameterType="touranswer">
      INSERT INTO tourAnswer (contentId, loginNum, loginId, loginPhoto, content, writeday, relevel, regroup)
      VALUES 
      (#{contentId}, #{loginNum}, #{loginId}, #{loginPhoto}, #{content}, now(),
         <if test="tourAnswerNum==null">0,
             CASE MAX(tourAnswerNum)
               WHEN null THEN 0
               [ELSE MAX(tourAnswerNum)+1]
         </if>
         <if test="tourAnswerNum!=null">1,#{regroup}</if>
      )
   </insert>
	<update id="deletePlaceAnswerByUser" parameterType="int">
		update tourAnswer set deleted=1 where tourAnswerNum=#{tourAnswerNum}
	</update>
	<update id="deletePlaceAnswerByAdmin" parameterType="int">
		update tourAnswer set deleted=2 where tourAnswerNum=#{tourAnswerNum}
	</update>
	<select id="getAnswerOfPlace" parameterType="int" resultType="touranswer">
		select * from tourAnswer where contentId=#{contentId} order by regroup asc,relevel asc
	</select>
	<select id="getUserAnswerPlace" parameterType="HashMap" resultType="touranswer">
		select * from tourAnswer where loginNum=#{loginNum} and relevel=0 order by tourAnswerNum desc 
	</select>
	<select id="getUserReAnswerPlace" parameterType="HashMap" resultType="touranswer">
		select * from tourAnswer where loginNum=#{loginNum} and relevel=1 order by tourAnswerNum desc 
	</select>
	

	<!-- 코스답글 쿼리 -->
	   <insert id="insertCourseAnswer" parameterType="touranswer">
      INSERT INTO tourAnswer (courseNum, userNum, loginNum, loginId, loginPhoto, content, writeday, relevel, regroup)
      VALUES 
      (#{courseNum}, #{userNum}, #{loginNum}, #{loginId}, #{loginPhoto}, #{content}, now(),
         <if test="tourAnswerNum==null">0,
             CASE MAX(tourAnswerNum)
               WHEN null THEN 0
               [ELSE MAX(tourAnswerNum)+1]
         </if>
         <if test="tourAnswerNum!=null">1,#{regroup}</if>
      )
   </insert>
	<update id="deleteCourseAnswerByUser" parameterType="int">
		update tourAnswer set deleted=1 where tourAnswerNum=#{tourAnswerNum}
	</update>
	<update id="deleteCourseAnswerByAdmin" parameterType="int">
		update tourAnswer set deleted=2 where tourAnswerNum=#{tourAnswerNum}
	</update>
	<select id="getAnswerOfCourse" resultType="touranswer">
		select * from tourAnswer where courseNum=#{courseNum} order by group asc,relevel asc
	</select>
	<select id="getUserAnswerCourse" parameterType="HashMap" resultType="touranswer">
		select * from tourAnswer where loginNum=#{loginNum} and relevel=#{relevel} order by tourAnswerNum desc 
	</select>
	<select id="getUserReAnswerCourse" parameterType="HashMap" resultType="touranswer">
		select * from tourAnswer where loginNum=#{loginNum} and relevel=1 order by tourAnswerNum desc 
	</select>
	
	<!-- 관리자용 전체 답글 출력 쿼리 -->
	<select id="getAdminAnswer" parameterType="int" resultType="touranswer">
		select * from tourAnswer where relevel=0 order by tourAnswerNum desc
	</select>
	<select id="getAdminReAnswer" parameterType="int" resultType="touranswer">
		select * from tourAnswer where relevel=1 order by tourAnswerNum desc
	</select>
</mapper>